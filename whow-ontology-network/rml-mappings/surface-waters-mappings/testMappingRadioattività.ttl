
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix l0: <https://w3id.org/italia/onto/l0/> .
@prefix iot: <https://w3id.org/italia/onto/IoT/> .
@prefix mu: <https://w3id.org/italia/onto/MU/> .
@prefix ti: <https://w3id.org/italia/onto/TI/> .
@prefix cov: <https://w3id.org/italia/onto/COV/> .
@prefix clv: <https://w3id.org/italia/onto/CLV/> .
@prefix indicator: <https://w3id.org/italia/onto/Indicator/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#>.
@prefix fnml: <http://semweb.mmlab.be/ns/fnml#> .
@prefix grel: <http://users.ugent.be/~bjdmeest/function/grel.ttl#> .
@prefix fno: <https://w3id.org/function/ontology#> .
@prefix idlab-fn: <http://example.com/idlab/function/> .
@prefix sd: <http://www.w3.org/ns/sparql-service-description#> .
@prefix places: <https://w3id.org/stlab/places/> .
@prefix core: <https://dati.isprambiente.it/ontology/core/> .
@prefix whow-water: <https://w3id.org/environmental-data/data/>.
@prefix ti: <https://w3id.org/italia/onto/TI/>.
@prefix inspire-mf: <https://dati.isprambiente.it/ontology/inspire-mf/>.
@prefix whow-adm: <https://w3id.org/environmental-data/data/water-administration-ontology>.
@base <https://w3id.org/environmental-data/onto/water-observation/> .

##########################################################
## LOGICAL SOURCES TO BE USED
##########################################################

# #LogicalSourceRadioactivity
<#LogicalSourceRadioactivity> a rml:BaseSource ;
    rml:source [
      a csvw:Table;
      csvw:url "ARPA-LOMBARDIA-Rete-Monitoraggio-RadioattivitÃ-Dati-2019-xlsx.csv";
      csvw:dialect [
        a csvw:Dialect;
        csvw:delimiter ","
      ]
    ];
    rml:referenceFormulation ql:CSV .

#aggiungere logicalsource fiumi


###########################################################
##                  MAPPING RULES
##########################################################


# #################################
# ## OBSERVATION  MAPPING:
# #################################
<#WaterObservationMapping> a rr:TriplesMap ;
rml:logicalSource <#LogicalSourceRadioactivity> ;
rr:subjectMap [
  rr:template "water-observation/{DESCRIZIONE MATRICE (2° livello)}-from-{Data inizio}-to-{Data fine}-{Provincia}-{Nuclide}-{Attività specifica}";
  rr:termType rr:IRI;
  rr:class whow-water:WaterRadioactivityObservation
] ;
rr:predicateObjectMap [
  rr:predicate rdfs:label;
  rr:objectMap [ rr:template "Observation for the water body {DESCRIZIONE MATRICE (2° livello)} from {Data inizio} to {Data fine} in the province of {Provincia}. Registered activity: {Attività specifica} for Nuclide {Nuclide}" ; rr:language "en" ]
];
###PROBLEMA: ISSUED NON PRENDE INTERVALLI
#rr:predicateObjectMap [
#  rr:predicate ti:issued;
  #rr:objectMap [rml:reference "{Data inizio}-{Data fine}"]
#];
rr:predicateObjectMap [
  rr:predicate places:hasMunicipality;
    rr:objectMap <#CreateMunicipalityURI-Function>
];
rr:predicateObjectMap [
  rr:predicate whow-water:hasWaterFeature;
  rr:objectMap [ rr:template "https://w3id.org/environmental-data/data/water-feature/{DESCRIZIONE MATRICE (2° livello)}-{Comune di prelievo}-{Provincia}"; rr:termType rr:IRI; ]
] ;
rr:predicateObjectMap [
  rr:predicate whow-water:hasObservedProperty;
  rr:objectMap [
  rr:template "https://w3id.org/environmental-data/data/observable-property/activity"; rr:termType rr:IRI;]
] ;

rr:predicateObjectMap [
  rr:predicate inspire-mf:hasObservationValue;
  rr:objectMap [ rr:template "https://w3id.org/environmental-data/data/observation-value/{Attività specifica}-{Unità di misura}"; rr:termType rr:IRI; ]
  ];

rr:predicateObjectMap [
  rr:predicate whow-water:hasObservablePropertyObject;
  rr:objectMap [ rr:template "https://w3id.org/environmental-data/data/observable-property-object/radioactivity-object/nuclide-{Nuclide}"; rr:termType rr:IRI; ]
];


rr:predicateObjectMap [
  rr:predicate places:hasProvince;
  rr:objectMap [
  rr:template "https://w3id.org/environmental-data/data/province/{Provincia}";]
].


<#HasObservablePropertyMapping> a rr:TriplesMap ;
rml:logicalSource <#LogicalSourceRadioactivity> ;
rr:subjectMap [
  rr:template "https://w3id.org/environmental-data/data/observable-property/activity";
  rr:termType rr:IRI;
  rr:class whow-water:ObservableProperty
] ;
rr:predicateObjectMap [
  rr:predicate rdfs:label;
  rr:objectMap [ rr:constant "https://w3id.org/environmental-data/data/observable-property/activity" ; rr:language "en" ]
];
rr:predicateObjectMap [
  rr:predicate core:name;
  rr:objectMap [ rr:template "Activity" ; rr:language "en" ]
].


<#ProvinceMapping> a rr:TriplesMap ;
rml:logicalSource <#LogicalSourceRadioactivity> ;
rr:subjectMap [
  rr:template "https://w3id.org/environmental-data/data/province/{Provincia}";
  rr:termType rr:IRI;
  rr:class places:Province
] ;
rr:predicateObjectMap [
  rr:predicate rdfs:label;
  rr:objectMap [ rr:template "Province of the observation." ; rr:language "en" ]
].
<#MunicipalityMapping> a rr:TriplesMap ;
rml:logicalSource <#LogicalSourceRadioactivity> ;
rr:subjectMap [
  rr:template "https://w3id.org/environmental-data/data/municipality/{Comune di prelievo}";
  rr:termType rr:IRI;
  rr:class places:Municipality
] ;
rr:predicateObjectMap [
  rr:predicate rdfs:label;
  rr:objectMap [ rr:template "Municipality of the observation." ; rr:language "en" ]
].
# #################################
# ## WATER FEATURE MAPPING
# #################################
<#WaterFeatureMapping> a rr:TriplesMap ;
rml:logicalSource <#LogicalSourceRadioactivity> ;
rr:subjectMap [
  rr:template "https://w3id.org/environmental-data/data/water-feature/{DESCRIZIONE MATRICE (2° livello)}";
  rr:termType rr:IRI;
  rr:class whow-water:WaterFeature
] ;
rr:predicateObjectMap [
  rr:predicate rdfs:label;
  rr:objectMap [ rr:template "{DESCRIZIONE MATRICE (2° livello)}" ; rr:language "it" ]
];
rr:predicateObjectMap [
  rr:predicate whow-water:hasWaterFeatureType;
  rr:objectMap [ rr:template "https://w3id.org/environmental-data/data/water-feature-type/{DESCRIZIONE MATRICE (1°livello)}" ;  rr:termType rr:IRI]
].

# #################################
# ## WATER FEATURE TYPE MAPPING
# #################################
<#WaterFeatureTypeMapping> a rr:TriplesMap ;
rml:logicalSource <#LogicalSourceRadioactivity> ;
rr:subjectMap [
  rr:template "https://w3id.org/environmental-data/data/water-feature-type/{DESCRIZIONE MATRICE (1°livello)}";
  rr:termType rr:IRI;
  rr:class whow-water:WaterFeatureType
] ;
rr:predicateObjectMap [
  rr:predicate rdfs:label;
  rr:objectMap [ rr:template "{DESCRIZIONE MATRICE (1°livello)}" ; rr:language "it" ]
].

# #################################
# ## PROPERTY AGENT MAPPING
# #################################
<#ChemicalAgentMapping> a rr:TriplesMap ;
rml:logicalSource <#LogicalSourceRadioactivity> ;
rr:subjectMap [
  rr:template "https://w3id.org/environmental-data/data/observable-property-object/radioactivity-object/nuclide-{Nuclide}";
  rr:termType rr:IRI;
  rr:class whow-water:RadioactivityObject
] ;
rr:predicateObjectMap [
  rr:predicate rdfs:label;
  rr:objectMap [ rr:template "Nuclide identifier for {Nuclide}" ; rr:language "en" ]
];

rr:predicateObjectMap [
  rr:predicate core:hasUniqueIdentifier;
  rr:objectMap [ rr:template "https://w3id.org/environmental-data/data/observable-property-object/radioactivity-object-identifier/nuclide-{Nuclide}" ; rr:language "en" ]
].


# #################################
# ## OBSERVATION VALUE MAPPING
# #################################

<#ObservationValueMapping> a rr:TriplesMap ;
rml:logicalSource <#LogicalSourceRadioactivity> ;
rr:subjectMap [
  rr:template "https://w3id.org/environmental-data/data/observation-value/{Attività specifica}-{Unità di misura}";
  rr:termType rr:IRI;
  rr:class inspire-mf:ObservationValue

] ;

rr:predicateObjectMap [
  rr:predicate rdfs:label;
  rr:objectMap [ rr:template "Observation value {Attività specifica} {Unità di misura}" ; rr:language "en" ]
];

rr:predicateObjectMap [
  rr:predicate core:hasValue;
  rr:objectMap [
  rr:template "https://w3id.org/environmental-data/data/value/{Attività specifica}";]
];

rr:predicateObjectMap [
  rr:predicate core:hasUnitOfMeasure;
  rr:objectMap [
  rr:template "https://w3id.org/environmental-data/data/um/{Unità di misura}";]
].

<#ObservationValueHasValueMapping> a rr:TriplesMap ;
rml:logicalSource <#LogicalSourceRadioactivity> ;
rr:subjectMap [
  rr:template "https://w3id.org/environmental-data/data/value/{Attività specifica}";
  rr:termType rr:IRI;
  rr:class core:Value
] ;

rr:predicateObjectMap [
rr:predicate core:value ;
rr:objectMap [ rr:template "{Attività specifica}"; rr:datatype xsd:float ]
];

rr:predicateObjectMap [
  rr:predicate rdfs:label;
  rr:objectMap [ rr:template "Value {Attività specifica}" ; rr:language "en" ]
].

<#UnitOfMeasureMapping> a rr:TriplesMap ;
rml:logicalSource <#LogicalSourceRadioactivity> ;
rr:subjectMap [
  rr:template "https://w3id.org/environmental-data/data/um/{Unità di misura}";
  rr:termType rr:IRI;
  rr:class core:UnitOfMeasure
] ;

rr:predicateObjectMap [
  rr:predicate rdfs:label;
  rr:objectMap [ rr:template "Unit of measure: {Unità di misura}" ; rr:language "en" ]
].


#########################################
#             FUNZIONI                  #
#########################################
<#CreateMunicipalityURI-functionValue>
     rr:predicateObjectMap [
       rr:predicate fno:executes ;
       rr:objectMap [ rr:constant grel:array_join ]
     ];

      rr:predicateObjectMap [
        rr:predicate grel:p_array_a ;
        rr:objectMap [ rr:constant "https://w3id.org/environmental-data/data/municipality"]
      ] ;
      rr:predicateObjectMap [
            rr:predicate grel:p_array_a ;
            rr:objectMap [
                  fnml:functionValue [                                  # The object is the result of the function
                      rml:logicalSource <#LogicalSourceRadioactivity> ;              # Use the same data source for input
                      rr:predicateObjectMap [
                          rr:predicate fno:executes ;                   # Execute the function…
                          rr:objectMap [ rr:constant grel:toLowerCase ] # grel:toLowercase
                      ] ;
                      rr:predicateObjectMap [
                          rr:predicate grel:valueParameter ;
                          rr:objectMap [ rml:reference "Comune di prelievo" ]         # Use as input the "name" reference
                      ]
                  ]
           ]
      ];
      rr:predicateObjectMap [
        rr:predicate grel:p_string_sep ;
        rr:objectMap [ rr:constant "/" ]
      ].


<#CreateMunicipalityURI-Function> #referenzia URI comune come object
    fnml:functionValue <#CreateMunicipalityURI-functionValue> ;
    rr:termType rr:IRI . #qui specifica sotto no

<#CreateMunicipalityURISubject-Function> #referenzia URI come soggetto
    fnml:functionValue <#CreateMunicipalityURI-functionValue> .
